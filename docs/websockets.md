# WebSockets

当使用`WebSocket`技术时, 客户端通常只实现了向服务器发送数据的方法. 因此, 服务器需要对<b>单播数据</b>和<b>广播数据</b>进行分析判断并完成正确的转发. 为了确保<b>安全性</b>, <b>降低耦合度</b>, <b>实现透明传输</b>并为<b>技术升级</b>留出空间, 服务器应该尽量减少对数据的解析工作.

因此, 本文档将介绍与服务器进行交互时客户端数据包的格式.

## 基本格式

客户端和服务器之间的数据传输采用<b>JSON</b>格式. 对数据包的加密将完全由客户端实现. 数据包由两部分组成: 一部分是数据包属性, 包括工作类型和接收单播客户端ID, 这部分将采用明文传输; 另一部分则是客户端发送的真实数据, 这部分可以进行<b>端到端(E2EE)</b>加密(取决于客户端). 

以下是一个数据包的示例.

```python
{
    "props": {
        # 工作类型: 表示进行单播, 缺省时则被服务器自动解析为广播.
        "type": "websocket.unicast",
        # 接收单播的客户端ID: 仅工作类型为"websocket.unicast"时参数有效.
    	"receivedClientID": "2023"
    },
    # 真实数据: 可进行加密, 内部数据格式由客户端维护.
    "data": {
        "text": "Hello, World!"
    }
}
```

### 广播

数据包属性`type`为`websocket.broadcast`或缺省时, 服务器均对数据进行广播.

### 单播

数据包属性`type`为`websocket.unicast`时, 服务器对数据进行单播.
